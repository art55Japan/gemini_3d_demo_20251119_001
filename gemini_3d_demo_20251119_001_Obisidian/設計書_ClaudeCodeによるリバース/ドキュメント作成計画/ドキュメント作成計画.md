# 設計書ドキュメント作成計画

> [!abstract] 概要
> 本計画書は「フェルトうさぎパラディン」プロジェクトのソースコードをリバースエンジニアリングし、**一から再構築可能なレベル**の設計書を作成するための計画を定義します。

---

## 目標

**このドキュメント群だけを読んで、同じアプリケーションを実装できる**

具体的には：
- コードを見なくても、同等の機能を持つアプリケーションを新規実装できる
- 全てのクラス、メソッド、プロパティの仕様が明確に定義されている
- 数値定数、座標、色など全てのマジックナンバーが文書化されている
- 処理フロー、状態遷移、データ構造が図解されている

---

## 対象プロジェクト

| 項目 | 内容 |
|------|------|
| **プロジェクト名** | Felt Rabbit Paladin WebXR（フェルトうさぎパラディン） |
| **ソース場所** | `C:\source\gemini_3d_demo_20251119_001\` |
| **総ソース行数** | 約2,200行（srcフォルダ内） |
| **ファイル数** | 20ファイル（JavaScript） |
| **主要技術** | Three.js, Vite, Web Audio API, WebXR, LocalStorage |

---

## ソースファイル一覧

### メインシステム（行数順）

| ファイル | 行数 | 役割 |
|---------|------|------|
| PlayerMesh.js | 354 | プレイヤー3Dモデル生成 |
| Game.js | 240 | ゲームメインループ・統合 |
| Slime.js | 206 | スライム敵キャラクター |
| SaveManager.js | 189 | セーブ/ロード管理 |
| SaveLoadUI.js | 178 | セーブUI画面 |
| PlayerPhysics.js | 175 | プレイヤー物理演算 |
| BuildSystem.js | 170 | ブロック配置システム |
| Input.js | 116 | 入力管理 |
| AudioManager.js | 109 | 効果音生成 |
| PlayerCombat.js | 106 | 戦闘システム |

### エンティティ・環境

| ファイル | 行数 | 役割 |
|---------|------|------|
| Block.js | 99 | ブロックエンティティ |
| Rock.js | 79 | 岩オブジェクト |
| Tree.js | 74 | 木オブジェクト |
| CameraManager.js | 74 | カメラ制御 |
| Player.js | 63 | プレイヤー統合クラス |
| Entity.js | 49 | エンティティ基底クラス |
| WorldManager.js | 47 | ワールド生成 |
| PlayerCollision.js | 38 | 衝突処理 |
| EntityManager.js | 36 | エンティティ管理 |
| main.js | 4 | エントリーポイント |

---

## 設計書構成

```
設計書_ClaudeCodeによるリバース/
│
├── _MOC_設計書.md                    # 目次・全体ナビゲーション
├── ドキュメント作成計画.md            # 本ファイル
│
├── 01_プロジェクト概要.md             # 技術スタック、ビルド方法
├── 02_アーキテクチャ設計.md           # レイヤー構造、依存関係図
├── 03_クラス設計.md                   # 全クラスの詳細仕様
├── 04_エンティティシステム設計.md     # Entity継承、ライフサイクル
├── 05_プレイヤーシステム設計.md       # コンポーネント構成
├── 06_ゲームループ・入力設計.md       # メインループ、入力マッピング
├── 07_セーブシステム設計.md           # データ構造、永続化フロー
├── 08_3Dグラフィックス設計.md         # メッシュ生成、テクスチャ
├── 09_UI設計.md                       # DOM構造、スタイル
└── 10_データ定義書.md                 # 定数、設定値一覧
```

---

## 各ドキュメントの詳細仕様

### 01_プロジェクト概要.md

**目的**: プロジェクトの環境構築と起動ができるようにする

**含める内容**:
- [ ] プロジェクト名、説明、対象プラットフォーム
- [ ] package.json の完全な内容
- [ ] index.html の完全な構造
- [ ] ディレクトリ構成図
- [ ] 開発環境セットアップ手順
- [ ] ビルド・起動コマンド
- [ ] 依存パッケージの役割説明

---

### 02_アーキテクチャ設計.md

**目的**: システム全体の構造を理解し、どこから実装を始めるか判断できる

**含める内容**:
- [ ] レイヤードアーキテクチャ図
- [ ] 全クラスの依存関係図（Mermaid）
- [ ] 初期化順序（どのクラスが先に生成されるか）
- [ ] データフロー図（入力→更新→描画）
- [ ] 採用している設計パターン一覧と適用箇所
- [ ] ファイル間のimport関係図

---

### 03_クラス設計.md

**目的**: 各クラスを正確に実装できる仕様を提供する

**含める内容**:
- [ ] 全クラスの一覧と概要
- [ ] 各クラスの詳細仕様:
  - クラス名、継承元
  - コンストラクタ引数
  - プロパティ一覧（名前、型、初期値、説明）
  - メソッド一覧（シグネチャ、引数、戻り値、処理概要）
- [ ] クラス間の関連図

---

### 04_エンティティシステム設計.md

**目的**: Entity継承ツリーと多態的な振る舞いを理解する

**含める内容**:
- [ ] Entity基底クラスの詳細仕様
- [ ] 継承ツリー図（クラスダイアグラム）
- [ ] 各サブクラスのオーバーライドメソッド一覧
- [ ] エンティティのライフサイクル図
- [ ] shouldRemove フラグによる削除フロー
- [ ] isSaveable/toSaveData/fromSaveData の多態実装仕様
- [ ] EntityManager との連携

---

### 05_プレイヤーシステム設計.md

**目的**: プレイヤーのコンポーネント構成と各コンポーネントの詳細を理解する

**含める内容**:
- [ ] コンポーネント構成図
- [ ] Player クラスと各コンポーネントの関係
- [ ] PlayerPhysics の詳細:
  - 物理パラメータ（重力、速度、摩擦など）
  - AABB衝突判定アルゴリズム
  - ジャンプ・移動の計算式
- [ ] PlayerCombat の詳細:
  - ステートパターン（IdleState/AttackingState）
  - 状態遷移図
  - 攻撃判定アルゴリズム
- [ ] PlayerCollision の詳細:
  - 敵との衝突判定
  - ダメージ処理フロー
- [ ] PlayerMesh の詳細:
  - 各パーツの構成と座標
  - テクスチャ生成アルゴリズム

---

### 06_ゲームループ・入力設計.md

**目的**: ゲームの心臓部であるメインループと入力システムを理解する

**含める内容**:
- [ ] Game.js の初期化フロー図
- [ ] render() メソッドの処理順序
- [ ] deltaTime の使用箇所と意味
- [ ] Input クラスの詳細:
  - キーマップ（キーコード→アクション）
  - getState() の戻り値構造
  - マウス入力の処理
  - VRコントローラー入力の処理
- [ ] クールダウン機構（セーブ/ロード/メニュー）
- [ ] ポーズ処理（UI表示中）

---

### 07_セーブシステム設計.md

**目的**: セーブ/ロード機能を完全に再実装できる

**含める内容**:
- [ ] LocalStorage のキー名規則
- [ ] セーブデータのJSON構造（スキーマ）
- [ ] クイックセーブ/ロードのフロー図
- [ ] スロットセーブのフロー図
- [ ] エンティティ復元アルゴリズム
- [ ] SaveLoadUI の画面構成と操作フロー
- [ ] エラー処理

---

### 08_3Dグラフィックス設計.md

**目的**: 全ての3Dオブジェクトを再現できる

**含める内容**:
- [ ] Three.js シーン構成
  - カメラ設定（FOV、near、far、初期位置）
  - ライト設定（種類、色、強度、位置）
  - 地面（サイズ、マテリアル）
- [ ] PlayerMesh の構築手順:
  - 各パーツの座標、サイズ、色
  - フェルトテクスチャ生成アルゴリズム
- [ ] Slime メッシュの構築
- [ ] Block メッシュの構築（タイプ別）
- [ ] Tree/Rock メッシュの構築
- [ ] BuildSystem のゴーストブロック

---

### 09_UI設計.md

**目的**: 全てのUI要素を再現できる

**含める内容**:
- [ ] オーバーレイ（Click to Start）
  - DOM構造
  - CSSスタイル値
  - イベントハンドラ
- [ ] 通知UI
  - DOM構造
  - アニメーション仕様
- [ ] SaveLoadUI
  - DOM構造
  - CSSスタイル値
  - ボタン配置とイベント

---

### 10_データ定義書.md

**目的**: 全てのマジックナンバーと設定値を一箇所にまとめる

**含める内容**:
- [ ] 物理定数
  - 重力加速度
  - 移動速度
  - ジャンプ力
  - 回転速度
- [ ] カラーコード一覧
  - 背景色
  - 各オブジェクトの色
  - UI色
- [ ] サイズ・座標定数
  - プレイヤーの各パーツサイズ
  - ブロックサイズ
  - 衝突判定ボックスサイズ
- [ ] タイミング定数
  - 攻撃持続時間
  - クールダウン時間
  - 通知表示時間
- [ ] キーマップ定義
- [ ] セーブキー名
- [ ] ワールド生成パラメータ

---

## 作業手順

### フェーズ1: 基盤ドキュメント作成

1. **01_プロジェクト概要.md** を作成
2. **02_アーキテクチャ設計.md** を作成
3. **_MOC_設計書.md** を作成

### フェーズ2: コア設計ドキュメント作成

4. **03_クラス設計.md** を作成
5. **04_エンティティシステム設計.md** を作成
6. **05_プレイヤーシステム設計.md** を作成

### フェーズ3: システム設計ドキュメント作成

7. **06_ゲームループ・入力設計.md** を作成
8. **07_セーブシステム設計.md** を作成

### フェーズ4: グラフィックス・UI設計ドキュメント作成

9. **08_3Dグラフィックス設計.md** を作成
10. **09_UI設計.md** を作成

### フェーズ5: リファレンス作成

11. **10_データ定義書.md** を作成

### フェーズ6: レビュー・検証

12. 全ドキュメントのクロスリファレンス確認
13. 再構築可能性の検証

---

## 品質基準

### 再構築可能性チェックリスト

- [ ] package.json を見てプロジェクトを作成できる
- [ ] index.html を見てHTMLを作成できる
- [ ] クラス設計を見て全クラスのスケルトンを作成できる
- [ ] 物理パラメータを見て同じ挙動を再現できる
- [ ] メッシュ構築手順を見て同じ3Dモデルを作成できる
- [ ] セーブデータ構造を見て互換性のあるセーブ機能を作成できる
- [ ] UI設計を見て同じ見た目のUIを作成できる

### ドキュメント品質基準

- 全ての数値定数は具体的な値が記載されている
- 全てのメソッドは引数と戻り値の型が明記されている
- 全ての処理フローは図解されている
- 曖昧な表現（「適宜」「必要に応じて」など）を避ける

---

## 見積もり

| フェーズ | ドキュメント数 | 想定作業量 |
|---------|--------------|-----------|
| フェーズ1 | 3 | 基盤となるため丁寧に作成 |
| フェーズ2 | 3 | 最もボリュームが大きい |
| フェーズ3 | 2 | 中程度 |
| フェーズ4 | 2 | 詳細な数値記載が必要 |
| フェーズ5 | 1 | 全ての定数を抽出 |
| フェーズ6 | - | 検証作業 |

---

## 関連リンク

- [[_MOC_設計書|設計書目次]]（作成後にリンク）

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-11-23 | 初版作成 |
