# 01. プロジェクト概要

> [!abstract] 概要
> 本ドキュメントは「フェルトうさぎパラディン」プロジェクトの技術構成、環境構築、起動方法を定義します。このドキュメントに従ってプロジェクトを新規作成できます。

---

## プロジェクト基本情報

| 項目 | 値 |
|------|-----|
| **プロジェクト名** | gemini-3d-demo |
| **表示名** | Felt Rabbit Paladin WebXR |
| **バージョン** | 0.0.0 |
| **モジュールシステム** | ES Modules |
| **対象プラットフォーム** | Web（デスクトップ）、WebXR（VR） |

---

## 技術スタック

### ランタイム依存

| パッケージ | バージョン | 用途 |
|-----------|----------|------|
| **three** | ^0.160.0 | 3Dグラフィックス描画、WebXR対応 |

### 開発依存

| パッケージ | バージョン | 用途 |
|-----------|----------|------|
| **vite** | ^5.0.0 | 開発サーバー、本番ビルド |
| **vitest** | ^4.0.13 | ユニットテスト |
| **@vitest/coverage-v8** | ^4.0.13 | コードカバレッジ |
| **jsdom** | ^27.2.0 | テスト用DOM環境 |

### ブラウザAPI

| API | 用途 |
|-----|------|
| **Web Audio API** | 効果音生成（AudioContext, OscillatorNode） |
| **WebXR Device API** | VRヘッドセット対応 |
| **LocalStorage** | セーブデータ永続化 |
| **Canvas API** | プロシージャルテクスチャ生成 |

---

## package.json

```json
{
  "name": "gemini-3d-demo",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "@vitest/coverage-v8": "^4.0.13",
    "jsdom": "^27.2.0",
    "vite": "^5.0.0",
    "vitest": "^4.0.13"
  },
  "dependencies": {
    "three": "^0.160.0"
  }
}
```

---

## index.html

```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Felt Rabbit Paladin WebXR</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    canvas {
      display: block;
    }
  </style>
</head>

<body>
  <div id="app"></div>
  <div id="error-container"
    style="position: absolute; top: 0; left: 0; color: red; background: rgba(255, 255, 255, 0.9); z-index: 9999; padding: 10px; white-space: pre-wrap;">
  </div>
  <script>
    window.addEventListener('error', function (event) {
      document.getElementById('error-container').textContent += 'Error: ' + event.message + '\n' + event.filename + ':' + event.lineno + '\n';
    });
    window.addEventListener('unhandledrejection', function (event) {
      document.getElementById('error-container').textContent += 'Promise Rejection: ' + event.reason + '\n';
    });
  </script>
  <script type="module" src="/src/main.js"></script>
</body>

</html>
```

### index.html 構造解説

| 要素 | 役割 |
|------|------|
| `<div id="app">` | アプリケーションコンテナ（現在は未使用） |
| `<div id="error-container">` | エラー表示用オーバーレイ（デバッグ用） |
| エラーハンドラスクリプト | グローバルエラーをキャッチして表示 |
| `<script type="module" src="/src/main.js">` | エントリーポイント |

### CSS設計

| プロパティ | 値 | 理由 |
|-----------|-----|------|
| `body { margin: 0 }` | 0 | ブラウザデフォルトマージン除去 |
| `body { overflow: hidden }` | hidden | スクロール防止 |
| `canvas { display: block }` | block | インライン要素の隙間除去 |

---

## ディレクトリ構成

```
gemini-3d-demo/
│
├── index.html                 # HTMLエントリーポイント
├── package.json               # プロジェクト設定
├── package-lock.json          # 依存関係ロック
│
├── src/                       # ソースコード
│   ├── main.js                # JSエントリーポイント (4行)
│   │
│   ├── Game.js                # メインコントローラ (240行)
│   │
│   ├── Entity.js              # エンティティ基底クラス (49行)
│   ├── EntityManager.js       # エンティティ管理 (36行)
│   │
│   ├── Player.js              # プレイヤー統合 (63行)
│   ├── PlayerMesh.js          # プレイヤー3Dモデル (354行)
│   ├── PlayerPhysics.js       # プレイヤー物理 (175行)
│   ├── PlayerCombat.js        # プレイヤー戦闘 (106行)
│   ├── PlayerCollision.js     # プレイヤー衝突 (38行)
│   │
│   ├── Slime.js               # スライム敵 (206行)
│   ├── Block.js               # ブロック (99行)
│   ├── Tree.js                # 木 (74行)
│   ├── Rock.js                # 岩 (79行)
│   │
│   ├── Input.js               # 入力管理 (116行)
│   ├── CameraManager.js       # カメラ管理 (74行)
│   ├── WorldManager.js        # ワールド生成 (47行)
│   ├── BuildSystem.js         # 建築システム (170行)
│   │
│   ├── SaveManager.js         # セーブ管理 (189行)
│   ├── SaveLoadUI.js          # セーブUI (178行)
│   │
│   ├── AudioManager.js        # 音声管理 (109行)
│   │
│   └── __tests__/             # テストファイル
│
├── public/                    # 静的ファイル
│   └── assets/
│       └── rabbit.png
│
└── node_modules/              # 依存パッケージ（自動生成）
```

---

## 環境構築手順

### 前提条件

| ソフトウェア | バージョン | 確認コマンド |
|-------------|----------|-------------|
| Node.js | 18.x 以上 | `node -v` |
| npm | 9.x 以上 | `npm -v` |

### セットアップ

```bash
# 1. プロジェクトディレクトリ作成
mkdir gemini-3d-demo
cd gemini-3d-demo

# 2. package.json 作成（上記内容をコピー）

# 3. 依存パッケージインストール
npm install

# 4. index.html 作成（上記内容をコピー）

# 5. src/ ディレクトリ作成
mkdir src
```

---

## 起動方法

### 開発モード

```bash
npm run dev
```

| 項目 | 値 |
|------|-----|
| **URL** | http://localhost:5173 |
| **特徴** | ホットリロード対応 |

### 本番ビルド

```bash
npm run build
```

| 項目 | 値 |
|------|-----|
| **出力先** | dist/ |
| **最適化** | ミニファイ、ツリーシェイキング |

### プレビュー

```bash
npm run preview
```

ビルド済みファイルをローカルサーバーで確認。

---

## エントリーポイント

### src/main.js

```javascript
import { Game } from './Game.js';

const game = new Game();
game.start();
```

**処理内容:**
1. Game クラスをインポート
2. Game インスタンスを生成（コンストラクタで全システム初期化）
3. `start()` でゲームループ開始

---

## Three.js バージョン詳細

### 使用モジュール

| モジュール | インポートパス | 用途 |
|-----------|--------------|------|
| THREE (コア) | `'three'` | Scene, Camera, Renderer, Mesh, etc. |
| VRButton | `'three/examples/jsm/webxr/VRButton.js'` | VR開始ボタン |

### バージョン 0.160.0 の機能

- WebGLRenderer（シャドウマップ対応）
- WebXR API 対応
- ES Modules ネイティブサポート

---

## ブラウザ要件

| 機能 | 必須/推奨 | 対応ブラウザ |
|------|----------|-------------|
| WebGL 2.0 | 必須 | Chrome 56+, Firefox 51+, Safari 15+ |
| ES Modules | 必須 | Chrome 61+, Firefox 60+, Safari 11+ |
| Web Audio API | 必須 | 全モダンブラウザ |
| WebXR | 推奨（VR用） | Chrome 79+, Edge 79+ |

---

## 操作方法

### キーボード

| キー | アクション |
|------|----------|
| W / ↑ | 前進 |
| S / ↓ | 後退 |
| A / ← | 左回転 |
| D / → | 右回転 |
| Space | ジャンプ |
| F / 左クリック | 攻撃 |
| B | ビルドモード切替 |
| 1-5 | ブロック色選択（ビルドモード中） |
| V | 視点切替（一人称/三人称） |
| K | クイックセーブ |
| L | クイックロード |
| M | データ管理メニュー |
| R | 緊急リセット |

### マウス

| 操作 | アクション |
|------|----------|
| 左クリック | 攻撃 / ブロック配置 |
| 右クリック | ブロック削除（ビルドモード中） |

### VRコントローラー

| 操作 | アクション |
|------|----------|
| トリガー | 攻撃 |
| スティック | 移動 |

---

## 関連ドキュメント

- [[02_アーキテクチャ設計|次: アーキテクチャ設計]]
- [[_MOC_設計書|設計書目次]]
- [[ドキュメント作成計画|作成計画]]

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-11-23 | 初版作成 |
