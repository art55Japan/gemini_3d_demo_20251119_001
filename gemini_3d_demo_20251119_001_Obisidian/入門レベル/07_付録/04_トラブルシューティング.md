---
tags:
  - 付録
  - トラブルシューティング
  - エラー
  - デバッグ
status: 完了
created: 2025-11-23
---

# トラブルシューティング

> [!abstract] 概要
> 開発中によく発生する問題とその解決方法をまとめています。エラーが発生したら、まずここを確認してください。

---

## 環境・セットアップ関連

### npm install が失敗する

> [!bug] 症状
> `npm install` 実行時にエラーが発生する

**解決方法:**
1. Node.js のバージョンを確認（16以上推奨）
   ```bash
   node -v
   ```
2. キャッシュをクリアして再実行
   ```bash
   npm cache clean --force
   rm -rf node_modules
   npm install
   ```
3. package-lock.json を削除して再実行
   ```bash
   rm package-lock.json
   npm install
   ```

---

### npm run dev が起動しない

> [!bug] 症状
> 開発サーバーが起動せず、エラーが表示される

**よくある原因と解決方法:**

| 原因 | 解決方法 |
|------|----------|
| ポートが使用中 | 別のターミナルで動いているサーバーを停止 |
| node_modules がない | `npm install` を実行 |
| Vite がインストールされていない | `npm install vite --save-dev` |

---

### ブラウザに何も表示されない

> [!bug] 症状
> サーバーは起動するが、画面が真っ黒/真っ白

**確認ポイント:**
1. コンソールにエラーがないか確認（F12 → Console）
2. `index.html` の `<script type="module">` を確認
3. ファイルパスが正しいか確認

---

## JavaScript エラー

### Uncaught ReferenceError: xxx is not defined

> [!bug] 症状
> 変数や関数が見つからないエラー

**よくある原因:**
```javascript
// ❌ import を忘れている
const game = new Game();  // Game is not defined

// ✅ import を追加
import { Game } from './Game.js';
const game = new Game();
```

```javascript
// ❌ スペルミス
const palyer = new Player();  // Player is not defined

// ✅ 正しいスペル
const player = new Player();
```

---

### Uncaught TypeError: Cannot read property 'xxx' of undefined

> [!bug] 症状
> undefined のプロパティにアクセスしようとしているエラー

**よくある原因と解決方法:**

```javascript
// ❌ オブジェクトが undefined
const player = undefined;
player.position.x;  // エラー！

// ✅ 存在確認をしてからアクセス
if (player) {
    player.position.x;
}

// または Optional Chaining
player?.position?.x;
```

```javascript
// ❌ 配列が空
const enemies = [];
enemies[0].hp;  // エラー！

// ✅ 長さを確認
if (enemies.length > 0) {
    enemies[0].hp;
}
```

---

### Uncaught TypeError: xxx is not a function

> [!bug] 症状
> 関数として呼び出せないエラー

**よくある原因:**
```javascript
// ❌ メソッド名のスペルミス
entity.updata();  // updata is not a function

// ✅ 正しいメソッド名
entity.update();
```

```javascript
// ❌ プロパティを関数として呼び出している
player.position();  // position is not a function

// ✅ プロパティはそのままアクセス
player.position;
player.position.x;
```

---

### Uncaught SyntaxError: Unexpected token

> [!bug] 症状
> 構文エラー

**よくある原因:**
```javascript
// ❌ カンマが足りない
const obj = {
    a: 1
    b: 2  // カンマがない
};

// ✅ カンマを追加
const obj = {
    a: 1,
    b: 2
};
```

```javascript
// ❌ 括弧の対応が合っていない
if (condition {  // ) がない
    // ...
}

// ✅ 括弧を正しく
if (condition) {
    // ...
}
```

---

## Three.js エラー

### 画面が真っ黒

> [!bug] 症状
> Three.js の描画が何も表示されない

**確認チェックリスト:**

- [ ] カメラの位置がオブジェクトの内側にないか
- [ ] カメラが正しい方向を向いているか
- [ ] Light（光源）を追加しているか
- [ ] オブジェクトが Scene に追加されているか
- [ ] Renderer のサイズが正しいか

```javascript
// カメラの確認
console.log('Camera position:', camera.position);
console.log('Camera target:', camera.getWorldDirection(new THREE.Vector3()));

// 光源の確認
console.log('Lights in scene:', scene.children.filter(c => c.isLight));

// オブジェクトの確認
console.log('Meshes in scene:', scene.children.filter(c => c.isMesh));
```

---

### オブジェクトが見えない

> [!bug] 症状
> Scene に追加したはずのオブジェクトが表示されない

**確認ポイント:**

| チェック項目 | 確認方法 |
|-------------|----------|
| position が極端な値 | `console.log(mesh.position)` |
| scale が 0 | `console.log(mesh.scale)` |
| visible が false | `console.log(mesh.visible)` |
| カメラの far より遠い | カメラ設定を確認 |
| Material が透明 | `opacity` と `transparent` を確認 |

```javascript
// デバッグ用: ワイヤーフレームで表示
mesh.material.wireframe = true;

// デバッグ用: 蛍光色にして目立たせる
mesh.material.color.set(0xff00ff);
```

---

### THREE is not defined

> [!bug] 症状
> Three.js がロードされていない

**解決方法:**
```javascript
// ❌ グローバル変数として使おうとしている
const scene = new THREE.Scene();

// ✅ import する
import * as THREE from 'three';
const scene = new THREE.Scene();
```

---

## ゲームロジックの問題

### キャラクターが動かない

> [!bug] 症状
> 入力しても動きがない

**確認チェックリスト:**

- [ ] Input の update() が毎フレーム呼ばれているか
- [ ] キーマップが正しいか
- [ ] delta が正しく渡されているか

```javascript
// デバッグ用
update(delta, input) {
    console.log('Input:', input);
    console.log('Delta:', delta);
}
```

---

### 衝突判定が効かない

> [!bug] 症状
> オブジェクトをすり抜けてしまう

**確認ポイント:**

1. **collidables 配列に追加されているか**
   ```javascript
   console.log('Collidables:', this.collidables);
   ```

2. **バウンディングボックスのサイズが正しいか**
   ```javascript
   // デバッグ用: バウンディングボックスを可視化
   const helper = new THREE.Box3Helper(boundingBox, 0xff0000);
   scene.add(helper);
   ```

3. **速度が速すぎてすり抜けていないか**
   - 1フレームでの移動量がオブジェクトサイズより大きいと問題
   - 解決: 速度を下げるか、連続衝突判定を実装

---

### セーブ/ロードが効かない

> [!bug] 症状
> データが保存・復元されない

**確認方法:**
```javascript
// LocalStorage の中身を確認
console.log(localStorage.getItem('gemini_3d_quick_save'));

// 全セーブデータを確認
for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    console.log(key, localStorage.getItem(key));
}
```

**よくある原因:**
- JSON.stringify でエラー（循環参照がある）
- isSaveable() が false を返している
- キー名が間違っている

---

## パフォーマンスの問題

### フレームレートが低い

> [!bug] 症状
> ゲームがカクカクする、fpsが低い

**確認と対策:**

1. **オブジェクト数を確認**
   ```javascript
   console.log('Total objects:', scene.children.length);
   ```

2. **ジオメトリの頂点数を減らす**
   ```javascript
   // 分割数を減らす
   new THREE.SphereGeometry(1, 8, 8);  // 32, 32 → 8, 8
   ```

3. **不要な描画を避ける**
   ```javascript
   // 見えないオブジェクトは非表示に
   mesh.visible = false;
   ```

4. **開発者ツールでプロファイル**
   - F12 → Performance タブで詳細分析

---

## デバッグのコツ

### console.log の活用

```javascript
// 値を確認
console.log('Position:', player.position);

// 複数の値をまとめて
console.log({ position: player.position, velocity: player.velocity });

// 条件付きログ
if (debugMode) console.log('Debug:', data);
```

### debugger の活用

```javascript
function update() {
    debugger;  // ここで実行が止まる
    // ブラウザの開発者ツールで変数を確認できる
}
```

### Three.js のヘルパー

```javascript
// 軸を表示
const axesHelper = new THREE.AxesHelper(5);
scene.add(axesHelper);

// グリッドを表示
const gridHelper = new THREE.GridHelper(10, 10);
scene.add(gridHelper);

// バウンディングボックスを表示
const boxHelper = new THREE.BoxHelper(mesh, 0xff0000);
scene.add(boxHelper);

// 光源の位置を表示
const lightHelper = new THREE.DirectionalLightHelper(light);
scene.add(lightHelper);
```

---

## それでも解決しない場合

> [!tip] 問い合わせ前のチェックリスト
> 1. エラーメッセージを正確にコピー
> 2. どの操作をしたときに発生するか
> 3. 再現手順を明確に
> 4. 最近変更したコードを確認

### 検索のコツ

- エラーメッセージをそのまま検索
- "Three.js" + キーワード で検索
- 英語で検索すると情報が多い

### 参考になるサイト

- [Stack Overflow](https://stackoverflow.com/questions/tagged/three.js)
- [Three.js Discourse](https://discourse.threejs.org/)
- [MDN Web Docs](https://developer.mozilla.org/ja/)

---

## 関連リンク

- [[03_用語集|前: 用語集]]
- [[05_パラダイム早見表|次: パラダイム早見表]]
- [[_MOC_付録|付録に戻る]]
