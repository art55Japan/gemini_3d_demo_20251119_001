# 入力・オーディオシステム

## 入力システム (Input)

### 概要
キーボード、マウス、およびVRコントローラーからの入力を統合し、統一された状態オブジェクト (`state`) として提供する。

### キーマッピング
データ駆動型のアプローチを採用し、`keyMap` オブジェクトでキーとアクションを紐付けている。

| キー | アクション | 説明 |
|---|---|---|
| W / ArrowUp | `forward` | 前進 |
| S / ArrowDown | `backward` | 後退 |
| A / ArrowLeft | `rotateLeft` | 左回転 |
| D / ArrowRight | `rotateRight` | 右回転 |
| Space | `jump` | ジャンプ |
| F | `attack` | 攻撃 |
| B | `toggleBuildMode` | 建築モード切替 |
| V | `toggleView` | 視点切替 (FPS/TPS) |
| K | `save` | クイックセーブ |
| L | `load` | クイックロード |
| M | `menu` | メニュー開閉 |

### マウス入力
- **移動**: マウス座標を正規化 (-1.0 ~ 1.0) して保持。
- **左クリック**: `mouseDown` フラグ (攻撃/ブロック配置)。
- **右クリック**: `rightMouseDown` フラグ (ブロック削除)。

### VR入力
WebXR Session の `inputSources` を監視し、ゲームパッド入力を処理する。
- **軸 (Axes)**: 左スティック等で移動 (`x`, `z`) を制御。デッドゾーン (0.1) あり。
- **ボタン**:
  - トリガー (Button 0): 攻撃 (`attack`)
  - グリップ (Button 1): ジャンプ (`jump`)

### 状態取得 (`getState`)
毎フレーム `getState()` が呼ばれ、現在のアクティブなキー、マウス状態、VR入力を集約したオブジェクトを返す。
移動ロジック (`state.z += backward ? 1 : 0`) はここで計算される。

## オーディオシステム (AudioManager)

### 概要
Web Audio API を使用し、外部ファイルに依存せず、オシレーターで効果音をプロシージャル生成する。

### AudioContext 管理
- ブラウザの自動再生ポリシーに対応するため、ユーザーインタラクション（クリック、キー押下）時に `resumeContext()` を呼び出してコンテキストを再開させる。

### 効果音生成
`OscillatorNode` (音源) と `GainNode` (音量) を接続して音を作成する。

| サウンド | 波形 | 周波数変化 | 音量エンベロープ |
|---|---|---|---|
| **ジャンプ** | Sine (正弦波) | 200Hz → 400Hz (上昇) | 0.2 → 0.01 (減衰) |
| **攻撃** | Triangle (三角波) | 400Hz → 100Hz (下降) | 0.15 → 0.01 (減衰) |
| **ヒット** | Sawtooth (ノコギリ波) | 100Hz → 50Hz (下降) | 0.2 → 0.01 (減衰) |
| **敵死亡** | Square (矩形波) | 200Hz → 50Hz (下降) | 0.1 → 0.01 (減衰) |

### BGM
現在は実装されていない (`startBGM` は空実装)。
