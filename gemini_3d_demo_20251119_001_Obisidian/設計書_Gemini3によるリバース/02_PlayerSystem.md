# プレイヤーシステム

## 概要
プレイヤーは `Player` クラスを中心に、機能ごとにコンポーネント化された設計となっている。
`Player` クラスは各コンポーネントの初期化と、毎フレームの更新処理の委譲を行う。

## コンポーネント構成

### 1. PlayerMesh (外観)
- プレイヤーの3Dモデル生成を担当。
- `Group` を使用して体、頭、腕、剣などを階層的に組み立てる。
- 剣 (`sword`) は名前で参照され、攻撃アニメーションに使用される。

### 2. PlayerPhysics (物理演算)
- **移動**: 入力ベクトルとカメラ（プレイヤー）の向きに基づいて移動ベクトルを計算。
- **重力**: 毎フレーム `velocity.y` に重力を加算。
- **衝突判定**: `moveAndCollide` メソッドで地形（`collidables`）との衝突を解決。
  - 軸ごとの分離軸判定（X軸移動→衝突解決→Z軸移動→衝突解決）。
  - Y軸移動後の着地判定 (`onGround` フラグ更新)。
- **ノックバック**: 敵からのダメージ時にノックバック速度を適用し、摩擦で減衰させる。

### 3. PlayerCombat (戦闘)
- **State Pattern** を採用。
  - `IdleState`: 待機状態。攻撃入力で `AttackingState` へ遷移。
  - `AttackingState`: 攻撃中。
    - アニメーション: 三角波関数 (`triangleWave`) を使用して剣を振る動作を計算（if文排除）。
    - 当たり判定: 攻撃動作の中間（20%〜60%）で `checkAttackCollision` を実行。
- **ポリモーフィズム**: `takeDamage` メソッドを持つエンティティに対してのみダメージを与える。

### 4. PlayerCollision (対エンティティ衝突)
- 敵（Slimeなど）との接触判定を行う。
- ポリモーフィズムを利用し、`entity.handleCollision(player, physics)` を呼び出すことで、衝突時の挙動（ダメージ、ノックバックなど）をエンティティ側に委譲している。

### 5. CameraManager (カメラ)
- **FPS/TPS 切り替え**: `V` キーで視点を切り替え可能。
- **FPSモード**: プレイヤーの頭の位置にカメラを配置。
- **TPSモード**: プレイヤーの背後上方にカメラを配置。

## 入力処理フロー
1. `Game.js` が `Input` クラスから入力を取得。
2. `Player.update()` に入力を渡す。
3. `Player` が各コンポーネント (`physics`, `combat`) に入力を伝播。
   - `physics`: 移動 (`x`, `z`)、ジャンプ (`jump`)
   - `combat`: 攻撃 (`attack`)
   - `camera`: 視点切替 (`toggleView`)
